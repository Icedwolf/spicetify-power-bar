var powerDbar=(()=>{var u,e,d=Object.create,g=Object.defineProperty,p=Object.getOwnPropertyDescriptor,f=Object.getOwnPropertyNames,m=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty,t=(e=>"undefined"!=typeof require?require:"undefined"!=typeof Proxy?new Proxy(e,{get:(e,t)=>("undefined"!=typeof require?require:e)[t]}):e)(function(e){if("react"===e)return Spicetify.React;if("react-dom"===e)return Spicetify.ReactDOM;if("undefined"!=typeof require)return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')}),i=(e,t)=>{t=g(null!=e?d(m(e)):{},"default",!t&&e&&e.__esModule?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0});var i=g(t,"__esModule",{value:!0}),n=e,s=void 0,r=void 0;if(n&&"object"==typeof n||"function"==typeof n)for(let e of f(n))h.call(i,e)||!s&&"default"===e||g(i,e,{get:()=>n[e],enumerable:!(r=p(n,e))||r.enumerable});return i},y=(u={"node_modules/classnames/index.js"(e,t){!function(){"use strict";var a={}.hasOwnProperty;function o(){for(var e=[],t=0;t<arguments.length;t++){var i=arguments[t];if(i){var n,s=typeof i;if("string"==s||"number"==s)e.push(i);else if(Array.isArray(i))!i.length||(n=o.apply(null,i))&&e.push(n);else if("object"==s)if(i.toString===Object.prototype.toString)for(var r in i)a.call(i,r)&&i[r]&&e.push(r);else e.push(i.toString())}}return e.join(" ")}void 0!==t&&t.exports?t.exports=o.default=o:"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("classnames",[],function(){return o}):window.classNames=o}()}},function(){return e||(0,u[f(u)[0]])((e={exports:{}}).exports,e),e.exports}),v=i(t("react")),b=i(t("react-dom")),n=i(t("react")),s="object"==typeof global&&global&&global.Object===Object&&global,w="object"==typeof self&&self&&self.Object===Object&&self,S=s||w||Function("return this")(),s=S.Symbol,w=Object.prototype,x=w.hasOwnProperty,E=w.toString,r=s?s.toStringTag:void 0;var k=function(e){var t=x.call(e,r),i=e[r];try{var n=!(e[r]=void 0)}catch(e){}var s=E.call(e);return n&&(t?e[r]=i:delete e[r]),s},C=Object.prototype.toString;var I=function(e){return C.call(e)},_=s?s.toStringTag:void 0;var P=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":(_&&_ in Object(e)?k:I)(e)};var N=function(e){return null!=e&&"object"==typeof e};var F=function(e){return"symbol"==typeof e||N(e)&&"[object Symbol]"==P(e)},j=/\s/;var O=function(e){for(var t=e.length;t--&&j.test(e.charAt(t)););return t},T=/^\s+/;var V=function(e){return e&&e.slice(0,O(e)+1).replace(T,"")};var D=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},B=/^[-+]0x[0-9a-f]+$/i,z=/^0b[01]+$/i,A=/^0o[0-7]+$/i,U=parseInt;var R=function(e){if("number"==typeof e)return e;if(F(e))return NaN;if(D(e)&&(t="function"==typeof e.valueOf?e.valueOf():e,e=D(t)?t+"":t),"string"!=typeof e)return 0===e?e:+e;e=V(e);var t=z.test(e);return t||A.test(e)?U(e.slice(2),t?2:8):B.test(e)?NaN:+e},M=function(){return S.Date.now()},H=Math.max,L=Math.min;var q=function(d,i,e){var n,s,r,a,o,l,c=0,g=!1,u=!1,t=!0;if("function"!=typeof d)throw new TypeError("Expected a function");function p(e){var t=n,i=s;return n=s=void 0,c=e,a=d.apply(i,t)}function f(e){var t=e-l;return void 0===l||i<=t||t<0||u&&r<=e-c}function m(){var e,t=M();if(f(t))return h(t);o=setTimeout(m,(e=i-((t=t)-l),u?L(e,r-(t-c)):e))}function h(e){return o=void 0,t&&n?p(e):(n=s=void 0,a)}function y(){var e=M(),t=f(e);if(n=arguments,s=this,l=e,t){if(void 0===o)return c=e=l,o=setTimeout(m,i),g?p(e):a;if(u)return clearTimeout(o),o=setTimeout(m,i),p(l)}return void 0===o&&(o=setTimeout(m,i)),a}return i=R(i)||0,D(e)&&(g=!!e.leading,u="maxWait"in e,r=u?H(R(e.maxWait)||0,i):r,t="trailing"in e?!!e.trailing:t),y.cancel=function(){void 0!==o&&clearTimeout(o),n=l=s=o=void(c=0)},y.flush=function(){return void 0===o?a:h(M())},y},a=i(t("react")),K=i(t("react-dom")),$="settings-module__settingsContainer___e9wxn_powerDbar",W=class{constructor(e,t,i={}){this.name=e,this.settingsId=t,this.initialSettingsFields=i,this.settingsFields=this.initialSettingsFields,this.setRerender=null,this.pushSettings=async()=>{for(Object.entries(this.settingsFields).forEach(([e,t])=>{"button"!==t.type&&void 0===this.getFieldValue(e)&&this.setFieldValue(e,t.defaultValue)});!Spicetify?.Platform?.History?.listen;)await new Promise(e=>setTimeout(e,100));this.stopHistoryListener&&this.stopHistoryListener(),this.stopHistoryListener=Spicetify.Platform.History.listen(e=>{"/preferences"===e.pathname&&this.render()}),"/preferences"===Spicetify.Platform.History.location.pathname&&await this.render()},this.rerender=()=>{this.setRerender&&this.setRerender(Math.random())},this.render=async()=>{for(;!document.getElementById("desktop.settings.selectLanguage");){if("/preferences"!==Spicetify.Platform.History.location.pathname)return;await new Promise(e=>setTimeout(e,100))}const i=document.getElementsByClassName("x-settings-container")[0];let n=Array.from(i.children).find(e=>e.id===this.settingsId);if(n)console.log(n);else{(n=document.createElement("div")).id=this.settingsId,n.className=$;let e=void 0,t=0;for(;;){try{var s=i.getElementsByClassName("x-settings-button");e=Array.from(s).find(e=>"button"===e.children[0]?.type)}catch(e){console.error('Error while finding "show advanced settings" button:',e)}if(e)break;if("/preferences"!==Spicetify.Platform.History.location.pathname)return void console.warn(`[spcr-settings] couldn't find "show advanced settings" button after ${t} tries.`);t++,console.log(`Couldn't find "show advanced settings" button. Trying again in 1000ms...`),await new Promise(e=>setTimeout(e,1e3))}i.insertBefore(n,e)}K.default.render(a.default.createElement(this.FieldsContainer,null),n)},this.addButton=(e,t,i,n,s)=>{this.settingsFields[e]={type:"button",description:t,value:i,events:{onClick:n,...s}}},this.addInput=(e,t,i,n,s)=>{this.settingsFields[e]={type:"input",description:t,defaultValue:i,events:{onChange:n,...s}}},this.addHidden=(e,t)=>{this.settingsFields[e]={type:"hidden",defaultValue:t}},this.addToggle=(e,t,i,n,s)=>{this.settingsFields[e]={type:"toggle",description:t,defaultValue:i,events:{onChange:n,...s}}},this.addDropDown=(e,t,i,n,s,r)=>{this.settingsFields[e]={type:"dropdown",description:t,defaultValue:i[n],options:i,events:{onSelect:s,...r}}},this.getFieldValue=e=>JSON.parse(Spicetify.LocalStorage.get(this.settingsId+"."+e)||"{}")?.value,this.setFieldValue=(e,t)=>{Spicetify.LocalStorage.set(this.settingsId+"."+e,JSON.stringify({value:t}))},this.FieldsContainer=()=>{var[e,t]=(0,a.useState)(0);return this.setRerender=t,a.default.createElement("div",{className:$,key:e},a.default.createElement("h2",{className:"main-shelf-title main-type-cello"},this.name),Object.entries(this.settingsFields).map(([e,t])=>a.default.createElement(this.Field,{nameId:e,field:t})))},this.Field=i=>{var e=this.settingsId+"."+i.nameId;let t;if(t="button"===i.field.type?i.field.value:this.getFieldValue(i.nameId),"hidden"===i.field.type)return a.default.createElement(a.default.Fragment,null);const[n,s]=(0,a.useState)(t),r=e=>{void 0!==e&&(s(e),this.setFieldValue(i.nameId,e))};return a.default.createElement(a.default.Fragment,null,a.default.createElement("div",{className:"main-type-mesto",style:{color:"var(--spice-subtext)"}},a.default.createElement("label",{htmlFor:e},i.field.description||"")),a.default.createElement("span",{className:"x-settings-secondColumn"},"input"===i.field.type?a.default.createElement("input",{className:"main-dropDown-dropDown",id:e,dir:"ltr",value:n,type:"text",...i.field.events,onChange:e=>{r(e.currentTarget.value);const t=i.field.events?.onChange;t&&t(e)}}):"button"===i.field.type?a.default.createElement("span",{className:""},a.default.createElement("button",{id:e,className:"main-buttons-button main-button-outlined",...i.field.events,onClick:e=>{r();const t=i.field.events?.onClick;t&&t(e)},type:"button"},n)):"toggle"===i.field.type?a.default.createElement("label",{className:"x-toggle-wrapper x-settings-secondColumn"},a.default.createElement("input",{id:e,className:"x-toggle-input",type:"checkbox",checked:n,...i.field.events,onClick:e=>{r(e.currentTarget.checked);const t=i.field.events?.onClick;t&&t(e)}}),a.default.createElement("span",{className:"x-toggle-indicatorWrapper"},a.default.createElement("span",{className:"x-toggle-indicator"}))):"dropdown"===i.field.type?a.default.createElement("select",{className:"main-dropDown-dropDown",id:e,...i.field.events,onChange:e=>{r(i.field.options[e.currentTarget.selectedIndex]);const t=i.field.events?.onChange;t&&t(e)}},i.field.options.map((e,t)=>a.default.createElement("option",{selected:e===n,value:t+1},e))):a.default.createElement(a.default.Fragment,null)))}}},J=i(y());async function G(e,t){e=encodeURIComponent(e.trim()),e=await Spicetify.CosmosAsync.get(`https://api.spotify.com/v1/search?q=${e}&type=album,artist,playlist,track&limit=${t}&include_external=audio`);{t=e;const i=Object.entries(t).filter(([,e])=>0<e.items.length).map(([e,t])=>({type:e,items:t.items})).reduce((e,t)=>{switch(t.type){case"tracks":e[0]=t;break;case"artists":e[1]=t;break;case"albums":e[2]=t;break;case"playlists":e[3]=t}return e},[]),n=i.flatMap(e=>e.items);return{categorizedSuggestions:i,suggestions:n}}}var o=i(t("react"));var l=i(t("react")),Q=i(y());function X({suggestion:e,onSuggestionClick:t,selected:i}){var n="track"===e.type||"album"===e.type,s="track"===e.type?null==(s=e.album)?void 0:s.images[0].url:null==(s=null==(s=e.images)?void 0:s[0])?void 0:s.url;return l.default.createElement("li",{className:(0,Q.default)("suggestion-item",{"has-info":n,"suggestion-item__active":i}),onClick:()=>t(e.uri)},l.default.createElement("img",{src:s,alt:e.name,className:"suggestion-item__img"}),l.default.createElement("div",{className:"suggestion-item__text"},l.default.createElement("span",null,e.name),n&&l.default.createElement("span",null,null==(i=e.artists)?void 0:i.map(e=>e.name).join(", "))))}function Y({categorizedSuggestions:e,onSuggestionClick:i,selectedSuggestionUri:n}){return o.default.createElement("div",{id:"power-bar-suggestions"},o.default.createElement("div",{id:"suggestions-container"},e.map(({type:e,items:t})=>o.default.createElement("ul",{key:e,className:"suggestions-category"},o.default.createElement("h5",null,function(e){return e.charAt(0).toUpperCase()+e.slice(1)}(e)),t.map(e=>o.default.createElement(X,{key:e.id,suggestion:e,selected:e.uri===n,onSuggestionClick:i}))))))}var Z=/^[a-z0-9]$/i,ee="results-per-category",c="key-combo",te="play-immediately",ie=["Shift","Control","Alt","Meta"],ne=class extends n.default.Component{constructor(e){super(e),this.isMac="osx"===Spicetify.Platform.PlatformData.os_name,this.suggestions=[],this.searchInput=n.default.createRef(),this.previousSearchValue="",this._selectedSuggestionIndex=0,this.debouncedSearch=q(async()=>{var e=this.settings.getFieldValue(ee),{categorizedSuggestions:t,suggestions:e}=await G(null==(t=this.searchInput.current)?void 0:t.value,e);this.setState({categorizedSuggestions:t}),this.suggestions=e,this.selectedSuggestionIndex=0},300),this.onSuggestionClick=e=>{this.onSelectSuggestion(e)},this.onInput=t=>{if(!this.isActivationKeyCombo(t.nativeEvent)){const{currentTarget:i,key:n}=t;let e=i.value.trim();if(Z.test(n)&&(e+=n),"Escape"!==n){if("ArrowUp"===n)return t.preventDefault(),void this.selectedSuggestionIndex--;if("ArrowDown"===n)return t.preventDefault(),void this.selectedSuggestionIndex++;if("Enter"===n)if(this.suggestions)return t=this.suggestions[this.selectedSuggestionIndex],void this.onSelectSuggestion(t.uri);!e||e.length<2?this.clearSuggestions():e!==this.previousSearchValue&&(this.previousSearchValue=e,this.debouncedSearch())}else i.value?(i.value="",this.clearSuggestions()):this.togglePowerBar()}},this.handleSettingsInput=e=>{e.preventDefault(),e.stopPropagation();const t=e.nativeEvent["code"],i=this.settings.getFieldValue(c);switch(t){case"Backspace":this.settings.setFieldValue(c,i.slice(0,-1)),e.currentTarget.value=e.currentTarget.value.split(",").slice(0,-1).join("");break;case"Enter":case"Tab":e.currentTarget.blur();break;default:if(2<=i.length)return;var n=ie.some(e=>t.includes(e));if(0===i.length&&!n)return;n=0===i.length?t.toLowerCase().replace(/left|right/gi,"Key").replace("control","ctrl"):t;this.settings.setFieldValue(c,[...i,n]),e.currentTarget.value=e.currentTarget.value?e.currentTarget.value+","+n:n}},this.state={active:!1,categorizedSuggestions:[],selectedSuggestionUri:""},this.settings=new W("Power bar settings","power-bar-settings",{"results-per-category":{type:"dropdown",description:"Show amount of suggestions per category",defaultValue:"3",options:["1","2","3","4","5","6","7","8","9","10"]},"key-combo":{type:"input",description:"Activation key combo. First key needs to be a modifier (shift, ctrl, alt or cmd/windows key).",defaultValue:[this.isMac?"altKey":"ctrlKey","Space"],events:{onKeyDown:this.handleSettingsInput,onBlur:e=>{0===this.settings.getFieldValue(c).length&&(e.currentTarget.placeholder="Please set a valid key combo",Spicetify.showNotification("Please set a valid key combo for the power bar"))}}},"play-immediately":{type:"toggle",description:"Play suggestion on click",defaultValue:!1}}),this.settings.pushSettings()}set selectedSuggestionIndex(e){(e=-1===e?this.suggestions.length-1:e)===this.suggestions.length&&(e=0),this._selectedSuggestionIndex=e,this.setState({selectedSuggestionUri:this.suggestions[e].uri},()=>{var e=document.getElementsByClassName("suggestion-item__active")[0],t=document.getElementById("power-bar-suggestions"),i=e.getBoundingClientRect(),{top:t,bottom:n}=t.getBoundingClientRect();(i.top<t||i.bottom>n)&&e.scrollIntoView()})}get selectedSuggestionIndex(){return this._selectedSuggestionIndex}componentDidMount(){document.addEventListener("keydown",e=>{this.isActivationKeyCombo(e)&&(e.preventDefault(),this.togglePowerBar())})}onSelectSuggestion(e){this.settings.getFieldValue(te)&&Spicetify.Player.playUri(e),e=e,(e=null==(e=Spicetify.URI.from(e))?void 0:e.toURLPath(!0))&&Spicetify.Platform.History.push(e),this.togglePowerBar()}togglePowerBar(){this.setState(e=>({active:!e.active})),this.state.active&&this.searchInput.current?(this.searchInput.current.focus(),this.searchInput.current.value=""):this.clearSuggestions()}clearSuggestions(){this.setState({categorizedSuggestions:[]}),this.suggestions=[]}isActivationKeyCombo(e){var t=e.target;if("INPUT"===(null==t?void 0:t.tagName)&&"power-bar-search"!==t.id)return!1;var[t,i]=this.settings.getFieldValue(c);return!!e[t]&&e.code===i}render(){return n.default.createElement("div",{id:"power-bar-container",className:(0,J.default)({hidden:!this.state.active}),onClick:this.togglePowerBar.bind(this)},n.default.createElement("div",{id:"power-bar-wrapper",onClick:e=>e.stopPropagation()},n.default.createElement("input",{ref:this.searchInput,type:"text",id:"power-bar-search",placeholder:"Search Spotify",className:(0,J.default)({"has-suggestions":0<this.state.categorizedSuggestions.length}),onKeyDown:this.onInput}),0<this.state.categorizedSuggestions.length&&n.default.createElement(Y,{categorizedSuggestions:this.state.categorizedSuggestions,selectedSuggestionUri:this.state.selectedSuggestionUri,onSuggestionClick:this.onSuggestionClick})))}};var se=async function(){for(;null==Spicetify||!Spicetify.Platform||null==Spicetify||!Spicetify.CosmosAsync;)await new Promise(e=>setTimeout(e,100));const e=document.createElement("div");e.style.display="block",b.default.render(v.default.createElement(ne,null),e),document.body.appendChild(e)};(async()=>{await se()})()})();(async()=>{var e;document.getElementById("powerDbar")||((e=document.createElement("style")).id="powerDbar",e.textContent=String.raw`
  .settings-module__settingsContainer___e9wxn_powerDbar{display:contents}#power-bar-container{display:flex;justify-content:center;height:100%;position:absolute;width:100%;z-index:100;background-color:rgba(0,0,0,.4);--pb-border-radius:8px}#power-bar-container #power-bar-wrapper{max-width:70rem;background-color:var(--spice-tab-active);border-radius:var(--pb-border-radius);box-shadow:5px 12px 40px 0 var(--spice-shadow);height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;top:10vh;position:absolute}#power-bar-container #power-bar-search{border:none;width:700px;font-size:2em;padding:8px 16px;color:var(--spice-text);background-color:transparent}#power-bar-container #power-bar-search.has-suggestions{border-bottom:1px solid var(--spice-shadow)}#power-bar-container #power-bar-suggestions{padding:1em 0 1em 1em;max-height:70vh;overflow-y:scroll}#power-bar-container #suggestions-container{display:flex;flex-direction:column;gap:1em}#power-bar-container .suggestions-category{display:flex;flex-direction:column;gap:4px}#power-bar-container .suggestions-category:not(:last-child){padding-bottom:1em;border-bottom:1px solid var(--spice-shadow)}#power-bar-container .suggestions-category p{font-size:12px;color:var(--spice-subtext)}#power-bar-container .suggestion-item{color:var(--spice-text);display:flex;gap:1em;align-items:center;padding:4px 8px;margin-left:-8px}#power-bar-container .suggestion-item:hover{cursor:pointer}#power-bar-container .suggestion-item__img{height:2rem;width:2rem}#power-bar-container .suggestion-item__text{display:flex;flex-direction:column}#power-bar-container .suggestion-item__active{background-color:var(--spice-button);border-radius:8px}#power-bar-container .suggestion-item__active span{color:var(--spice-main)!important}#power-bar-container .suggestion-item.has-info span:nth-child(1){font-weight:700}#power-bar-container .suggestion-item.has-info span:nth-child(2){color:var(--spice-subtext);font-size:14px;margin-top:-4px}#power-bar-container .hidden{display:none!important}
      `.trim(),document.head.appendChild(e))})();